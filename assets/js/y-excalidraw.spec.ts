import { describe, expect, test } from "vitest";
import { syncElementsToYArray } from "./y-excalidraw";
import * as Y from "yjs";

describe("syncElementsToYArray", () => {
  const ydoc = new Y.Doc();
  test("adds 1 + 2 to equal 3", () => {
    const array = ydoc.getArray<Y.Map<unknown>>("elements");
    const e1 = [
      {
        id: "cIQh4r6HOcWQTbIKlVdc7",
        type: "freedraw",
        x: 927.3333740234375,
        y: 171.66668701171875,
        width: 0,
        height: 0,
        angle: 0,
        strokeColor: "#1e1e1e",
        backgroundColor: "transparent",
        fillStyle: "solid",
        strokeWidth: 2,
        strokeStyle: "solid",
        roughness: 1,
        opacity: 100,
        groupIds: [],
        frameId: null,
        roundness: null,
        seed: 1238615798,
        version: 2,
        versionNonce: 1130941290,
        isDeleted: false,
        boundElements: null,
        updated: 1726214549611,
        link: null,
        locked: false,
        points: [[0, 0]],
        pressures: [],
        simulatePressure: true,
        lastCommittedPoint: null,
      },
    ] as const;
    const e2 = [
      {
        id: "cIQh4r6HOcWQTbIKlVdc7",
        type: "freedraw",
        x: 927.3333740234375,
        y: 171.66668701171875,
        width: 76.6666259765625,
        height: 162,
        angle: 0,
        strokeColor: "#1e1e1e",
        backgroundColor: "transparent",
        fillStyle: "solid",
        strokeWidth: 2,
        strokeStyle: "solid",
        roughness: 1,
        opacity: 100,
        groupIds: [],
        frameId: null,
        roundness: null,
        seed: 1238615798,
        version: 22,
        versionNonce: 246133354,
        isDeleted: false,
        boundElements: null,
        updated: 1726214550044,
        link: null,
        locked: false,
        points: [
          [0, 0],
          [-62.66668701171875, 62.666656494140625],
          [-68.66668701171875, 75.33331298828125],
          [-72, 96],
          [-72, 100],
          [-70.66668701171875, 112],
          [-69.3333740234375, 119.33331298828125],
          [-66, 124],
          [-60, 134.66665649414062],
          [-50, 144],
          [-42.66668701171875, 149.33331298828125],
          [-36, 152.66665649414062],
          [-30, 154.66665649414062],
          [-28.66668701171875, 155.33331298828125],
          [-18.66668701171875, 158.66665649414062],
          [-17.3333740234375, 158.66665649414062],
          [-12, 160.66665649414062],
          [-8, 161.33331298828125],
          [-6.66668701171875, 162],
          [3.33331298828125, 162],
          [4.6666259765625, 162],
        ],
        pressures: [],
        simulatePressure: true,
        lastCommittedPoint: null,
      },
    ] as const;
    const e3 = [
      {
        id: "cIQh4r6HOcWQTbIKlVdc7",
        type: "freedraw",
        x: 927.3333740234375,
        y: 171.66668701171875,
        width: 77.33331298828125,
        height: 162.66665649414062,
        angle: 0,
        strokeColor: "#1e1e1e",
        backgroundColor: "transparent",
        fillStyle: "solid",
        strokeWidth: 2,
        strokeStyle: "solid",
        roughness: 1,
        opacity: 100,
        groupIds: [],
        frameId: null,
        roundness: null,
        seed: 1238615798,
        version: 24,
        versionNonce: 1958584298,
        isDeleted: false,
        boundElements: null,
        updated: 1726214550375,
        link: null,
        locked: false,
        points: [
          [0, 0],
          [-62.66668701171875, 62.666656494140625],
          [-68.66668701171875, 75.33331298828125],
          [-72, 96],
          [-72, 100],
          [-70.66668701171875, 112],
          [-69.3333740234375, 119.33331298828125],
          [-66, 124],
          [-60, 134.66665649414062],
          [-50, 144],
          [-42.66668701171875, 149.33331298828125],
          [-36, 152.66665649414062],
          [-30, 154.66665649414062],
          [-28.66668701171875, 155.33331298828125],
          [-18.66668701171875, 158.66665649414062],
          [-17.3333740234375, 158.66665649414062],
          [-12, 160.66665649414062],
          [-8, 161.33331298828125],
          [-6.66668701171875, 162],
          [3.33331298828125, 162],
          [4.6666259765625, 162],
          [5.33331298828125, 162.66665649414062],
          [5.33331298828125, 162.66665649414062],
        ],
        pressures: [],
        simulatePressure: true,
        lastCommittedPoint: [5.33331298828125, 162.66665649414062],
      },
      {
        id: "_FY_CXdx9ffRERbgVngnV",
        type: "freedraw",
        x: 994.6666870117188,
        y: 203.66668701171875,
        width: 94.66668701171875,
        height: 13.33331298828125,
        angle: 0,
        strokeColor: "#1e1e1e",
        backgroundColor: "transparent",
        fillStyle: "solid",
        strokeWidth: 2,
        strokeStyle: "solid",
        roughness: 1,
        opacity: 100,
        groupIds: [],
        frameId: null,
        roundness: null,
        seed: 1837712630,
        version: 13,
        versionNonce: 1690477482,
        isDeleted: false,
        boundElements: null,
        updated: 1726214588511,
        link: null,
        locked: false,
        points: [
          [0, 0],
          [-12, 3.33331298828125],
          [-16.66668701171875, 4.666656494140625],
          [-21.33331298828125, 6],
          [-28, 7.33331298828125],
          [-56.66668701171875, 11.33331298828125],
          [-60, 12],
          [-68.66668701171875, 12.666656494140625],
          [-84, 12.666656494140625],
          [-86.66668701171875, 12.666656494140625],
          [-92.66668701171875, 12.666656494140625],
          [-94.66668701171875, 13.33331298828125],
        ],
        pressures: [],
        simulatePressure: true,
        lastCommittedPoint: null,
      },
    ] as const;
    const e4 = [
      {
        id: "cIQh4r6HOcWQTbIKlVdc7",
        type: "freedraw",
        x: 927.3333740234375,
        y: 171.66668701171875,
        width: 77.33331298828125,
        height: 162.66665649414062,
        angle: 0,
        strokeColor: "#1e1e1e",
        backgroundColor: "transparent",
        fillStyle: "solid",
        strokeWidth: 2,
        strokeStyle: "solid",
        roughness: 1,
        opacity: 100,
        groupIds: [],
        frameId: null,
        roundness: null,
        seed: 1238615798,
        version: 24,
        versionNonce: 1958584298,
        isDeleted: false,
        boundElements: null,
        updated: 1726214550375,
        link: null,
        locked: false,
        points: [
          [0, 0],
          [-62.66668701171875, 62.666656494140625],
          [-68.66668701171875, 75.33331298828125],
          [-72, 96],
          [-72, 100],
          [-70.66668701171875, 112],
          [-69.3333740234375, 119.33331298828125],
          [-66, 124],
          [-60, 134.66665649414062],
          [-50, 144],
          [-42.66668701171875, 149.33331298828125],
          [-36, 152.66665649414062],
          [-30, 154.66665649414062],
          [-28.66668701171875, 155.33331298828125],
          [-18.66668701171875, 158.66665649414062],
          [-17.3333740234375, 158.66665649414062],
          [-12, 160.66665649414062],
          [-8, 161.33331298828125],
          [-6.66668701171875, 162],
          [3.33331298828125, 162],
          [4.6666259765625, 162],
          [5.33331298828125, 162.66665649414062],
          [5.33331298828125, 162.66665649414062],
        ],
        pressures: [],
        simulatePressure: true,
        lastCommittedPoint: [5.33331298828125, 162.66665649414062],
      },
      {
        id: "_FY_CXdx9ffRERbgVngnV",
        type: "freedraw",
        x: 994.6666870117188,
        y: 203.66668701171875,
        width: 104,
        height: 13.33331298828125,
        angle: 0,
        strokeColor: "#1e1e1e",
        backgroundColor: "transparent",
        fillStyle: "solid",
        strokeWidth: 2,
        strokeStyle: "solid",
        roughness: 1,
        opacity: 100,
        groupIds: [],
        frameId: null,
        roundness: null,
        seed: 1837712630,
        version: 20,
        versionNonce: 884557546,
        isDeleted: false,
        boundElements: null,
        updated: 1726214588674,
        link: null,
        locked: false,
        points: [
          [0, 0],
          [-12, 3.33331298828125],
          [-16.66668701171875, 4.666656494140625],
          [-21.33331298828125, 6],
          [-28, 7.33331298828125],
          [-56.66668701171875, 11.33331298828125],
          [-60, 12],
          [-68.66668701171875, 12.666656494140625],
          [-84, 12.666656494140625],
          [-86.66668701171875, 12.666656494140625],
          [-92.66668701171875, 12.666656494140625],
          [-94.66668701171875, 13.33331298828125],
          [-95.33331298828125, 13.33331298828125],
          [-98.66668701171875, 13.33331298828125],
          [-99.33331298828125, 13.33331298828125],
          [-100, 13.33331298828125],
          [-102.66668701171875, 13.33331298828125],
          [-104, 13.33331298828125],
          [-104, 13.33331298828125],
        ],
        pressures: [],
        simulatePressure: true,
        lastCommittedPoint: [-104, 13.33331298828125],
      },
    ] as const;
    syncElementsToYArray(e1, array);
    syncElementsToYArray(e2, array);
    syncElementsToYArray(e3, array);
    syncElementsToYArray(e4, array);

    expect(array.toJSON()).toMatchSnapshot();
  });
});
